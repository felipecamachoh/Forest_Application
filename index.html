<!DOCTYPE html>
<html lang="en">
<head>
<meta name="google-site-verification" content="d4UvR4DDDHrWuyZZ8WyH8G12YFi4iEWSOVatbARVkdI" />
  <meta charset="utf-8">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Cesium.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  
  <style type="text/css">

    

    /******* Style for Layers Dropwdown Menus *******/
    .dropdown {
        display: inline-block;
        z-index: 1000;
        color: white;
        background-color: #313336; 
        border: 1px solid black; 
        padding: 8px 16px; 
        font-size: 12px; 
        font-weight: bold; 
        text-transform: uppercase; 
        border-radius: 5px; 
        cursor: pointer;
        transition: all 0.2s ease-in-out; 
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8); 
        font-family: 'arial', sans-serif;
        height: 15px;
    }
    .dropdown:hover { 
        background-color: #5586b7; cursor: pointer;  
        box-shadow: 0 0 8px 2px rgba(237, 255, 255, 0.7);
    }
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: white;
        color: red;
        min-width: 200px;
        box-shadow: 0 8px 16px 0 #2e2e2e;
        z-index: 1000;
        max-height: 300px;
        overflow-y: auto;
        overflow-x: hidden;
        border-radius: 2px;
        top: 35px;
    }
    .dropdown-content label {
        color: white; 
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        transition: background-color 0.2s ease-in-out;
        font-size: 14px;
        margin-bottom: -5px; 
        font-family: 'Arial', sans-serif;
        font-size: 13px;
        font-weight: 500;
    }
    .dropdown-content input[type='checkbox'] {
        margin-bottom: 5px;
    }
    .dropdown:hover .dropdown-content { 
        display: block;
    }
    .dropdown:hover .dropdown-content label {
        color: black;
    }
    

    /******* Style for the second layers controls (When the swipe is enabled) *******/
    #layerControls2 {
        left: 70%;
        display: none;
    }

    /******* Style for the Legend Elements *******/

    /***** Style for the Glacier Area Legend Elements *****/
    #legend {
        display: none;
        bottom: 15%;
        left: 25px;
        background: white;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
    }
    #legend span {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    #legend .color-box {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 10px;
    }

    #legend h3 {
        margin-top: 5px;
        text-align: center;
        font-family: Arial, sans-serif;
        font-size: 15px;
    }

    /***** Style for the LST Legend Elements *****/
    #legend-LST {
        display: none;
        bottom: 35%;
        left: 25px;
        background: white;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
    }
    #legend-LST span {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    #legend-LST .color-box {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 10px;
    }
    #legend-LST h3 {
        margin-top: 5px;
        text-align: center;
        font-family: Arial, sans-serif;
        font-size: 15px;
    }

    #LST-Colors {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 10px;
    }
    #LST-Numbers{
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }
    .legend-content-LST {
        background: linear-gradient(90deg, rgba(50,53,108,1) 0%, rgba(71,59,135,1) 10%, rgba(96,61,145,1) 20%, rgba(193,57,130,1) 45%, rgba(235,119,84,1) 75%, rgba(237,232,48,1) 95%);
    }
    #LST-Numbers span {
        font-family: Arial, sans-serif;
        font-size: 15px;
    }

    /***** Style for the AIR Legend Elements *****/
    #legend-AIR {
        display: none;
        bottom: 55%;
        left: 25px;
        background: white;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
    }
    #legend-AIR span {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    #legend-AIR .color-box {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 10px;
    }
    #AIR-Numbers {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }
    #legend-AIR h3 {
        margin-top: 5px;
        text-align: center;
        font-family: Arial, sans-serif;
        font-size: 15px;
    }
    .legend-content-AIR {
        background: linear-gradient(90deg, rgba(40,52,142,1) 0%, rgba(68,125,179,1) 30%, rgba(100,180,194,1) 45%, rgba(173,216,183,1) 70%, rgba(255,255,209,1) 95%);   
    }    
    /******* Style for the Splash Screens and the interactive buttons *******/

    /***** First Splash Screen *****/
    #splashScreen {
        display: block;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgb(255, 255, 255);
        padding: 20px;
        border-radius: 10px;
        z-index: 1002;
        text-align: center;
        box-shadow: 0 0 5px rgb(0, 0, 0);
        width: 600px;
        max-width: 90%;
        height: 450px;
        max-height: 90%;
        overflow: auto;
        font-family: Arial, sans-serif;
        font-size: 14px;
    }    
    #splashScreen-paragraph {
        text-align: justify;
    }
    #splashScreen button {
        margin-top: 30px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        font-family: Arial, sans-serif;
        font-weight: bold;
    }
    #splashScreen button:hover { 
        background-color: #45a049;
    }
    #buttonPanel {
        display: grid;
        grid-template-columns: repeat(3, 1fr); 
        justify-content: center;
        gap: 5px;
        margin-top: 25px;
    }
    #buttonPanel > button:first-child {
        grid-column: 2 / span 1; 
        padding: 10px 20px;
    }
    #buttonPanel > button:last-child {
        grid-column: 3;
        padding: 10px 20px;
    }
    #splashScreen button:last-child {
        width: 10px;
        justify-self: end; 
    }

    /***** Second Splash Screen *****/
    #splashScreen2 {
        display: block;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        z-index: 1002;
        text-align: center;
        box-shadow: 0 0 5px rgb(0, 0, 0);
        width: 600px;
        max-width: 90%;
        height: 450px;
        max-height: 90%;
        overflow: auto;
        font-family: Arial, sans-serif;
        font-size: 14px;
    }
    #splashScreen2 button {
        margin-top: 30.8px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        font-family: Arial, sans-serif;
        font-weight: bold;
    }
    #splashScreen2 button:hover { 
        background-color: #45a049;
    }
    #buttonPanel2 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        justify-content: center;
        gap: 5px;
        margin-top: 15px;
    }
    #splashScreen2 button:first-child {
        width: 10px;
        justify-self: start;          
    }
    #splashScreen2 button:last-child {
        width: 10px;
        justify-self: end;
    }
    #splashScreen2 span{
        text-align: left;
    }

    /***** Thirds Splash Screen *****/
    #splashScreen3 {
        display: block;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        z-index: 1002;
        text-align: center;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        width: 600px;
        max-width: 90%;
        height: 450px;
        max-height: 90%;
        overflow: auto;
        box-shadow: 0 0 5px rgb(0, 0, 0);
        font-family: Arial, sans-serif;
        font-size: 14px;
    }
    #splashScreen3 button {
        margin-top: 100.5px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        font-family: Arial, sans-serif;
        font-weight: bold;
    }
    #splashScreen3 button:hover {
        background-color: #45a049; 
    }
    #buttonPanel3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        justify-content: center;
        gap: 5px;
        margin-top: 20px;
    }
    #splashScreen3 button:first-child {
        width: 10px;
        justify-self: start;           
    }
    #splashScreen3 button:last-child {
        width: 10px;
        justify-self: end;
    }
    
    /***** Fourth Splash Screen *****/
    #splashScreen4 {
        display: block;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        z-index: 1002;
        text-align: center;
        box-shadow: 0 0 5px rgb(0, 0, 0);
        width: 600px;
        max-width: 90%;
        height: 450px;
        max-height: 90%;
        overflow: auto;
        font-family: Arial, sans-serif;
        font-size: 14px;
    }
    #splashScreen4 button {
        margin-top: 0.5px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        font-family: Arial;
        font-weight: bold;
    }
    #splashScreen4 button:hover {
        background-color: #45a049;
    }
    #splashScreen4 span {
        text-align: left;
    }
    #buttonPanel4 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        justify-content: center;
        gap: 5px;
        margin-top: 55px;
    }
    #buttonPanel4> button:first-child {
        grid-column: 1 / span 1;
        padding: 10px 20px;
        justify-self: end;
    }
    #buttonPanel4 > button:last-child {
        grid-column: 2 / span 1;
        padding: 10px 20px;
    }
    #splashScreen4 button:first-child {
        width: 10px;
        justify-self: start;
    }

    /******* Styles for the Cesium Native elements and the infobox-iframe *******/
    #cesiumContainer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
    }
    .cesium-infoBox {
        width: 100%;
        height: auto;
        overflow-y: hidden;
        margin: 30px 10px 0 0;
        max-width: 400px;
        max-height: 800px;
        z-index: 15000;
    }
    .cesium-infoBox-iframe {
        height:600px !important;
        width: 100% !important;
    }
    .cesium-infoBox img {
        width: 100%;
        height: auto;
        display: block;
    }
    .cesium-infoBox-description {
        padding: 15px;
        text-align: center;
        min-height: 400px;
        max-height: 600px;
        overflow-y: auto;

    }

    /******* Style for the "Select Glacier" button *******/
    #dropdown-glacier.cesium-button {
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        margin-right: 10px;
    }
    #dropdown-glacier.cesium-button:hover {
        background-color: #5586b7;
        box-shadow: 0 0 2px 2px rgba(237, 255, 255, 0.7);
    }
    #dropdown-glacier.cesium-button:focus {
        box-shadow: 0 0 2px 2px rgba(237, 255, 255, 0.7);
    }
    #dropdown-glacier.cesium-button option {
        background-color: #313336;
        color: white;
        font-family: 'Arial', sans-serif;
        font-size: 13px;
    }

    /******* Style for the "Select Imagery Type" button *******/
    #dropdow-imagery.cesium-button {
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        margin-right: 10px;
    }
    #dropdow-imagery.cesium-button:hover {
        background-color: #5586b7;
        box-shadow: 0 0 8px 2px rgba(237, 255, 255, 0.7);
    }
    #dropdow-imagery.cesium-button:focus {
        box-shadow: 0 0 2px 2px rgba(237, 255, 255, 0.7);
    }
    #dropdow-imagery.cesium-button option {
        background-color: #313336;
        color: white;
        font-family: 'Arial', sans-serif;
        font-size: 13px;
    }

    /******* Style for the "Select Period" button *******/
    #dropdow-year.cesium-button {
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        margin-right: 10px;
    }
    #dropdow-year.cesium-button:hover {
        background-color: #5586b7;
        box-shadow: 0 0 8px 2px rgba(237, 255, 255, 0.7);
    }
    #dropdow-year.cesium-button:focus {
        box-shadow: 0 0 2px 2px rgba(237, 255, 255, 0.7);
    }
    #dropdow-year.cesium-button option {
        background-color: #313336;
        color: white;
        font-family: 'Arial', sans-serif;
        font-size: 13px;
    }

    /******* Style for the "Submit" button *******/
    #toggle-imagery{
        color: black;
        background-color: #edffff;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.8);
        margin-left: 2px;
    }
    #toggle-imagery:focus {
        box-shadow: 0 0 2px 2px rgba(237, 255, 255, 0.7);
    }    
    #toggle-imagery:hover{
        background-color: #4CAF50;
        box-shadow: 0 0 8px 2px rgba(237, 255, 255, 0.7);
    }
    #toggle-imagery:active {
        box-shadow: 0 0 2px 2px rgba(237, 255, 255, 0.7);
        transform: translateY(4px);
    }

    /******* Style for the "SWIPE" button *******/
    #toggle-swipe{
        z-index: 1000; 
        width: 70px; 
        height: 32px; 
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.8);
        margin-right: 10px;
    }
    #toggle-swipe:hover{
        background-color: #5586b7;
        box-shadow: 0 0 8px 2px rgba(237, 255, 255, 0.7);
    }

    /******* Style for the "SHOW/HIDE LEGEND" button and legend elements *******/
    #legend-controls {
        grid-row-start: 4;
        width: 100%;
        z-index: 1000; 
        width: 150px; 
        height: 40px; 
        color: white;
        background-color: rgba(161, 158, 158, 0.44);
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer; 
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        bottom: 50px;
        justify-self: start;
    }
    #legend-controls:hover{
        background-color: #5586b7;
        box-shadow: 0 0 8px 2px rgba(237, 255, 255, 0.7);
    }

    /******* Style for the container element of the four main buttons *******/
    #toolbar-container {
        display: grid;
        grid-template-columns: repeat(4, auto);
        gap: 5px;
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1000;
        background-color: rgba(161, 158, 158, 0.44);
        border-radius: 5px;
        padding: 3px;
    }

    /******* Style for the container element of the swipe and cesium native buttons *******/
    #toolbar-container-2 {
        display: grid;
        grid-template-columns: repeat(1, minmax(0, 1fr));
        gap: 5px;
        position: fixed;
        top: 10px;
        right: 70px;
        z-index: 1000;
        border-radius: 5px;
        padding: 3px;
        max-width: 95%;
    }

    /******* Style for the cesium native buttons *******/
    .cesium-viewer-toolbar{
        top:10px
    }

    /******* Style for the container of the two layers menus *******/
    #layers-container {
        display: grid;
        grid-template-columns: repeat(1, minmax(0, 1fr));
        gap: 10px;
        position: fixed;
        top: 10px;
        right: 300px;
        z-index: 1000;
        border-radius: 5px;
        padding: 3px;
        max-width: 95%;
        background-color: rgba(161, 158, 158, 0.44);
    }

    /******* Styles for the distance scale box and elements *******/
    #scaleBox {
        padding: 0px 10px;
        bottom: 45px;
        right: 9px;
        position: absolute;
        display: inline-block;
        background: rgba(161, 158, 158, 0.44);
        color: #bacdcc;
        border-radius: 5px;
        font-family: Arial;
        font-size: 14px;
        font-style: normal;
        text-align: center;
        white-space:pre-wrap;
        z-index: 1200;
    }
    .scale-text
    {
        display: inline-block;
        position: relative;
        color: white;
        border-radius: 2px;
        padding: 0px 0px;
        margin: 0px 0px;
        left: -12px;
        font-family: Arial;
        font-size: 14px;
        font-style: normal;
        text-align: center;
        white-space:pre-wrap;
    }
    .scalebar
    {
        background-color: white;
        height:6px;
        width:100px;
        padding-left: 5%;
        margin-top: 10px;
        margin-left: auto;
        margin-right: auto;
        z-index: 15000;
    }

    /******* Styles for the links, grids and images of the first splash screen *******/
    #infoGrid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 0px;
        margin-bottom: 0px;
    }
    #supportGrid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        align-items: center;
        gap: 0px;
        margin-top: 10px;
        margin-bottom: 0px;
        margin-left: -10px;
        justify-items: center;
    }
    #supportGrid p {
        font-weight: bold;
    }
    #supportGrid img {
        width: 80%; 
        height: auto;
    }
    #creditsGrid {
        display: grid;
        grid-template-columns: auto auto;
        align-items: center;
        justify-content: start;
        gap: 10px;
        margin-bottom: 20px;
        margin-left: 20px;
    }
    #creditsGrid p:first-child {
        font-weight: bold;
    }

    /******* Styles for the buttons and content of the second splash screen. *******/
    #SelectGlacier-instructions-button, #SelectPeriod-instructions-button, #SelectImagery-instructions-button  {
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer; 
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        display: inline-block;
        margin-right: 10px;
        text-decoration: none;
        font-family: 'Arial', sans-serif;
    }
    #ToggleImagery-instructions-button{
        color: black;
        background-color: #edffff;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease; 
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.8);
        margin-left: 2px;
        width: 50px;
        font-family: 'Arial', sans-serif;
    }
    #LayersPanel-instructions-button{
        display: inline-block;
        z-index: 1000;
        display: inline-block;
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        font-family: 'arial', sans-serif;
        height: 15px;
        width: 55px;
    }
    #Swipe-instructions-button{
        z-index: 1000; 
        width: 55px; 
        height: 15px; 
        color: white;
        background-color: #313336;
        border: 1px solid black; 
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.8);
        margin-right: 10px;
        font-family: 'arial', sans-serif;
    }
    .instructions-grid {
        display: grid;
        grid-template-columns: auto 1fr;
        grid-row-gap: 10px;
        align-items: center;
        margin-top: 20px;
    }
    .instruction-item {
        display: contents;
    }
    .instruction-item p {
        margin: 0;
    }
    .instruction-item span {
        padding-left: 10px;
    }

    /******* Styles for the buttons and content of the third screen. *******/
    .layers-instructions-grid {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
    }
    .layers-instruction-item {
        display: flex;
        justify-content:center;
        width: 100%;
    }
    #leftside-instructions-button
    {
        color: white; 
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        display: inline-block;
        margin-right: 10px;
        text-decoration: none;
        font-family: 'Arial', sans-serif;
        width: 75px;
        height:18px;
    }
    #rightside-instructions-button
    {
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        display: inline-block;
        margin-right: 10px;
        text-decoration: none;
        font-family: 'Arial', sans-serif;
        width: 75px;
        height:18px;
    }

    /******* Styles for the buttons and content of the fourth splash screen. *******/
    .additional-functionalities-grid {
        display: grid;
        grid-template-columns: auto 1fr;
        grid-row-gap: 30px;
        column-gap: 20px;
        align-items: center;
        margin-top: 20px;
    }
    .additional-functionalities-item {
        display: contents;
    }
    .additional-functionalities p {
        margin: 0;
    }
    .additional-functionalities span {
        padding-left: 10px;
    }
    .additional-functionalities-item span:first-child {
        font-weight: bold;
    }

    /******* Styles for the legend container and elements. *******/
    #legends-container {
        display: grid;
        grid-template-rows: 1fr auto;
        gap: 10px;
        position: absolute;
        bottom: 120px;
        left: 10px;
        width: 200px;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
        font-family: Arial, sans-serif;
    }
    #legends-container h3{
        font-size: 15px;
    }

    /******* Styles for the legend button and container *******/
    #legends-controls-container {
        display: grid;
        grid-template-rows: 1fr;
        position: absolute;
        bottom: 40px;
        left: 10px;
        width: auto;
        padding: 5px;
        border-radius: 5px;
        z-index: 1000;
        background: rgba(161, 158, 158, 0.44);
        height: auto;
    }
    #legend-controls{
        z-index: 1000; 
        width: 130px; 
        height: 40px; 
        color: white;
        background-color: #313336;
        border: 1px solid black;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.8);
    }

    /******* Styles for the layer update status info *******/
    #layer-status-container {
        display: none;
        grid-template-rows: 1fr;
        grid-template-columns: 95% 5%;
        position: absolute;
        width: 240px;
        height: auto;
        color: white;
        background-color: #313336;
        left: 10px;
        top: 60px;
        border-radius: 5px;
        padding: 5px;
        align-items: center;
        font-weight: 500;
        transition: opacity 2s ease-out;
        opacity: 0.8;
    }
    #layer-status-message {
        overflow: hidden;
        text-overflow: ellipsis;
        font-family: Arial, sans-serif;
        font-size: 13.5px;
    }
    #close-layer-status {
        cursor: pointer;
        background: transparent;
        border: none;
        color: white;
        font-weight: bold;
        outline: none;
        justify-self: end;
        align-self: start; 
    }

    /******* Version Styles  *******/
    .version {
        font-size: 0.5em; /* Adjust the size as needed */
        
    }

    /******* Additional Styles  *******/
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
    }

    /******* Styles for Responsive Design *******/

    /* Adjustments for different screen widths */
    @media (max-width: 1300px) {
    
    /******* Style for the container element of the four main buttons (1300px) *******/
    #toolbar-container {
        grid-template-columns: repeat(1, auto);
    }
    /******* Styles for the layer update status info (1300px) *******/
    #layer-status-container {
        left: 10px;
        top: 190px;    
        }
    }

    </style>
</head>

<body>
    <div id="cesiumContainer">
        <div id="layers-container">
            <!-- Dropdown for Layer Control -->
            <div class="dropdown" id = "layerControls1">
                <span class="dropbtn">Layers</span>
                <div class="dropdown-content" id="layerControls">
                    <label><input type="checkbox" id="InitialGeoJSON"> PATAGONIA</label>
                    <!-- More checkboxes added via JavaScript -->
                </div>
            </div>
            <!-- Second Dropdown for Layer Control -->
            <div class="dropdown" id="layerControls2">
                <span class="dropbtn">Layers Swipe</span>
                <div class="dropdown-content" id="layerscontrol2-dropdown">
                    <label><input type="checkbox" id="InitialGeoJSON"> PATAGONIA</label>
                    <!-- More checkboxes added via JavaScript -->
                </div>
            </div>
        </div>

        <div id="toolbar-container">
            <!-- Toolbar for Glacier Selection -->
            <div id="toolbar-glacier">
                <select class="cesium-button" id="dropdown-glacier">
                    <!-- Options will be dynamically added here -->
                </select>
            </div>    
            <!-- Toolbar for Imagery Selection -->
            <div id="toolbar-imagery">
                <select class="cesium-button" id="dropdow-imagery">
                    <option disabled selected>Select Imagery Type</option>
                    <option value="0">Forest Area</option>
                    <option value="1">Land Surface Temperature</option>
                    <option value="2">Air Temperature</option>
                </select>
            </div>
            <!-- Toolbar for Year Selection -->
            <div id="toolbar-year">
                <select class="cesium-button" id="dropdow-year">
                    <option disabled selected>SELECT PERIOD</option>
                    <option value="0">2018 - 2019</option>
                    <option value="1">2019 - 2020</option>
                    <option value="2">2020 - 2021</option>
                </select>
            </div>
            <!-- Button to Add Imagery -->
            <button id="toggle-imagery">Submit</button>
        </div>

        <div id="toolbar-container-2">
            <!-- Button to Enable Swipe -->
            <button id="toggle-swipe">Swipe</button>
        </div>
        
        <div id="legends-container">
            
            <!-- Glacier Area Legend -->
            <div id="legend">
                <h3>COVER</h3>
                <div style="display: flex; flex-direction: column; align-items: left; margin-top: 10px; margin-left:20px;font-size: 14px;">
                    <span><span class="color-box" style="background-color: #2a5f11;"></span>FOREST</span>
                    <span><span class="color-box" style="background-color: #ffebb5;"></span>OTHER</span>
                </div>
            </div>
            <!-- LST Imagery Legend -->
            <div id="legend-LST">
                <h3>LAND SURFACE TEMPERATURE (°C)</h3>
                <div class="legend-content-LST">
                    <span><span class="color-box"></span></span>
                </div>
                <div id="LST-Numbers">
                    <span>8.49</span>
                    <span>47.31</span>
                </div>
            </div>
            <!-- AIR TEMPERATURE Imagery Legend -->
            <div id="legend-AIR">
                <h3>AIR TEMPERATURE (°C)</h3>
                <div class="legend-content-AIR">
                    <span><span class="color-box"></span></span>
                </div>
                <div id="AIR-Numbers">
                    <span>-22.99</span>
                    <span>30.09</span>
                </div>
            </div>
        </div>

        <div>
            <div id="legends-controls-container">
            <!-- Legend Controls Button -->
                <button id="legend-controls" style="display: none;">Hide Legend</button>
            </div>
        </div>
    
        <!-- Splash Screen -->
        <div id="splashScreen">
            <h2>Welcome to the 3D Forest Monitoring Viewer. <span class="version">Ver. 1.0.0</span></h2>
            <p id = "splashScreen-paragraph">This application enables dynamic 3D visualization of forested areas across various national parks. It provides detailed insights into Forest Extent, Land Surface Temperature, and Air Temperature trends during the dry seasons from 2018 to 2023. The data is derived from processing Landsat 8 and 9, Sentinel-2, and ERA5-Land imagery through Google Earth Engine (GEE). This application is a modified version of the original master's thesis work.</p>
            
            <div id="infoGrid">
                <a href="https://www.youtube.com/watch?v=m7tQ8Tt5EJk" target="_blank">Click for Video Tutorial</a>
                <a href="https://gee-felipecamachoh-patagonia.projects.earthengine.app/view/colombian-natural-parks-forests" target="_blank">Click for GEE Application</a>
            </div>
        
            <div id="supportGrid">
                <p>Supported By:</p>
                <a href="https://www.plus.ac.at/?lang=en" target="_blank">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Logo_der_Universit%C3%A4t_Salzburg.jpg/1200px-Logo_der_Universit%C3%A4t_Salzburg.jpg" alt="Supporting Organization 1">
                </a>
                <a href="https://www.upol.cz/en/" target="_blank">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/80/Palacky_University_Olomouc_logo.png" alt="Supporting Organization 2">
                </a>
                <a href="https://master-cde.eu/" target="_blank">
                    <img src="https://master-cde.eu/wp-content/uploads/2020/05/CMIDE-logoCMYK.png" alt="Supporting Organization 3">
                </a>
            </div>
        
            <div id="createdByContainer">
                <p><strong>Created by:</strong> <a href="https://www.linkedin.com/in/felipe-camacho-hurtado/" target="_blank">Felipe Camacho Hurtado</a></p>
            </div>
        
            <div id="buttonPanel">
                <button onclick="document.getElementById('splashScreen').style.display='none'">START</button>
                <button onclick="document.getElementById('splashScreen').style.display='none'; document.getElementById('splashScreen2').style.display='block';">></button>
            </div>
        </div>
        
        <!-- Splash Screen2 -->
        <div id="splashScreen2" style="display: none;">
            <h2>How to use the App</h2>
            <p>Below you will find the main buttons and their functionality. <br><strong> (Hover on each button to highlight its location in the layout)</strong></p>
            <div class="instructions-grid">
                <div class="instruction-item">
                    <p id="SelectGlacier-instructions-button" 
                        onmouseover="document.getElementById('dropdown-glacier').style.backgroundColor='#5586b7', document.getElementById('dropdown-glacier').style.boxShadow='0 0 2px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('dropdown-glacier').style.backgroundColor=''; document.getElementById('dropdown-glacier').style.boxShadow='';">
                        SELECT GLACIER
                    </p>
                    <span>Select the glacier you are interested in from the dropdown menu.</span>
                </div>
                <div class="instruction-item">
                    <p id="SelectImagery-instructions-button" 
                        onmouseover="document.getElementById('dropdow-imagery').style.backgroundColor='#5586b7', document.getElementById('dropdow-imagery').style.boxShadow='0 0 2px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('dropdow-imagery').style.backgroundColor=''; document.getElementById('dropdow-imagery').style.boxShadow='';">
                        SELECT IMAGERY TYPE
                    </p>
                    <span>Decide on the type of imagery to be displayed for the selected glacier.</span>
                </div>
                <div class="instruction-item">
                    <p id="SelectPeriod-instructions-button" 
                        onmouseover="document.getElementById('dropdow-year').style.backgroundColor='#5586b7', document.getElementById('dropdow-year').style.boxShadow='0 0 2px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('dropdow-year').style.backgroundColor=''; document.getElementById('dropdow-year').style.boxShadow='';">
                        SELECT PERIOD
                    </p>
                    <span>Choose the time period for which you want to view the glacier data.</span>
                </div>
                <div class="instruction-item">
                    <p id="ToggleImagery-instructions-button" 
                        onmouseover="document.getElementById('toggle-imagery').style.backgroundColor='#4CAF50', document.getElementById('toggle-imagery').style.boxShadow='0 0 8px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('toggle-imagery').style.backgroundColor=''; document.getElementById('toggle-imagery').style.boxShadow='';">
                        SUBMIT
                    </p>
                    <span>Submit your selections to update the glacier visualization.</span>
                </div>
                <div class="instruction-item">
                    <p id="LayersPanel-instructions-button" 
                        onmouseover="document.getElementById('layerControls1').style.backgroundColor='#5586b7', document.getElementById('layerControls1').style.boxShadow='0 0 8px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('layerControls1').style.backgroundColor=''; document.getElementById('layerControls1').style.boxShadow='';">
                        LAYERS
                    </p>
                    <span>Contain options to turn on/off the layers and modify their transparency.</span>
                </div>
                <div class="instruction-item">
                    <p id="Swipe-instructions-button" 
                        onmouseover="document.getElementById('toggle-swipe').style.backgroundColor='#5586b7', document.getElementById('toggle-swipe').style.boxShadow='0 0 8px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('toggle-swipe').style.backgroundColor=''; document.getElementById('toggle-swipe').style.boxShadow='';">
                        SWIPE
                    </p>
                    <span>Enables the swipe functionality to visualize and compare imagery side to side.</span>
                </div>
            </div>

            <div id="buttonPanel2">
                <button onclick="document.getElementById('splashScreen2').style.display='none'; document.getElementById('splashScreen').style.display='block';"><</button>
                <button id="getstarted2" onclick="document.getElementById('splashScreen2').style.display='none'">START</button>
                <button onclick="document.getElementById('splashScreen3').style.display='block'; document.getElementById('splashScreen2').style.display='none'">></button>
            </div>
        </div>
        
        <!-- Splash Screen3 -->
        <div id="splashScreen3" style="display: none;">
            <h2>How does the Swipe works?</h2>
            <p>After activating the Swipe feature, the map layout will be split into two distinct sections. Each section of the map layout will operate independently, allowing for separate layer displays. You can control in which side of the split view to display a particular layer by checking or unchecking it in the following panels:</p>
            <div class="layers-instructions-grid">
                <div class="layers-instruction-item">
                    <p id="leftside-instructions-button" 
                    onmouseover="document.getElementById('layerControls1').style.backgroundColor='#5586b7', document.getElementById('layerControls1').style.boxShadow='0 0 8px 2px rgba(237, 255, 255, 0.7)';" 
                    onmouseout="document.getElementById('layerControls1').style.backgroundColor=''; document.getElementById('layerControls1').style.boxShadow='';">
                        LEFT SIDE
                    </p>
                    <p id="rightside-instructions-button" 
                        onmouseover="document.getElementById('layerControls2').style.backgroundColor='#5586b7', document.getElementById('layerControls2').style.boxShadow='0 0 2px 2px rgba(237, 255, 255, 0.7)';" 
                        onmouseout="document.getElementById('layerControls2').style.backgroundColor=''; document.getElementById('layerControls2').style.boxShadow='';">
                        RIGHT SIDE
                    </p>
                </div>
            </div>
            <p>Then, you can move the swipe divisor to compare the layers enabled in each panel.</p>
            <p>By design each layer can be displayed in one, both or none of the swipe sides. Considering this, you have to manually check or unchecked the visibility for the layers of interest.</p>


            <div id="buttonPanel3">
                <button onclick="document.getElementById('splashScreen3').style.display='none'; document.getElementById('splashScreen2').style.display='block';"> < </button>
                <button id="getstarted3" onclick="document.getElementById('splashScreen3').style.display='none'">START</button>
                <button onclick="document.getElementById('splashScreen4').style.display='block'; document.getElementById('splashScreen3').style.display='none'"> > </button>
            </div>
        </div>
    
        <!-- Splash Screen4 -->
        <div id="splashScreen4" style="display: none;">
            <h2>Additional Functionalities</h2>
            <div class="additional-functionalities-grid">
                <div class="additional-functionalities-item">
                    <span>View Home</span>
                    <span> When clicked, resets the camera to the initial view, showcasing the default geographical extent.</span>
                </div>
                <div class="additional-functionalities-item">
                    <span>Navigation <br> Instructions</span>
                    <span>When clicked, displays the application and navigation instructions.</span>
                </div>
                <div class="additional-functionalities-item">
                    <span>Distance <br> Scale</span>
                    <span> A dynamic scale bar that measures distances on the map in kilometers.</span>
                </div>
                <div class="additional-functionalities-item">
                    <span>Pop-ups</span>
                    <span>Enabled when selecting a glacier or clicking the current selection in the map. It displays the Glacier area, Land Surface Temperature and Air temperature Time series charts and related information.</span>
                </div>
                <div class="additional-functionalities-item">
                    <span>Legend</span>
                    <span>Displayed since the first time a specific type of imagery is added.</span>
                </div>
            </div>

            <div id="buttonPanel4">
                <button onclick="document.getElementById('splashScreen4').style.display='none'; document.getElementById('splashScreen3').style.display='block';"> < </button>
                <button id="getstarted4" onclick="document.getElementById('splashScreen4').style.display='none'">START</button>
            </div>
        </div>   
    </div>
    
    <div id="scaleBox">
        <div id="scalebar" class="w3-container w3-grey scalebar"></div>
        <p id="scalebartag" class="scale-text">Distance Scale</p>
    </div>

    <div id="layer-status-container">
        <span id="layer-status-message">Loading:</span>
        <button id="close-layer-status" style="float: right;">X</button>
    </div>

    <!---------------- JAVASCRIPT IMPLEMENTATION --------------------->
    <script type="module">
        let initialSplashScreenClosed = false;
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhNWIwYTJmNC02ZWI2LTRhMjEtYTAwOC0yYzFiMTI3Zjk2YjciLCJpZCI6MTg5ODE0LCJpYXQiOjE3MDUzMTg4MjB9.G7uMRy1yiKRraTdIvk2HPZptxhSfB-tsDegfvaIOA9I';
        let geoJsonDataSource;
        let lastSelectedEntity = null;

        // Cesium Viewer Setup
        const viewer = new Cesium.Viewer('cesiumContainer', {
            terrain: Cesium.Terrain.fromWorldTerrain(),
            animation: false,
            timeline: false,
            baseLayerPicker: false,
            imageryProvider: false,
            scene3DOnly: true,
            shadows: false,
            geocoder: false,
            allowTextureFilterAnisotropic : false,
            
        });

        // Load Basemap imagery layer
        const layer = viewer.imageryLayers.addImageryProvider(
            await Cesium.IonImageryProvider.fromAssetId(2)
        );

        // Dropdowns for Glacier and Year selection
        const dropdownGlacier = document.getElementById('dropdown-glacier');
        const dropdownYear = document.getElementById('dropdow-year');
        
        /********************************************************************************
        * Asynchronously loads GeoJSON data and updates the UI components.
        * - Loads GeoJSON data from Cesium Ion.
        * - Synchronizes checkboxes in different panels for GeoJSON layer visibility.
        * - Populates the dropdown menu with glacier names from the GeoJSON data.
        ********************************************************************************/
        
        async function loadGeoJson() {
            // Load GeoJSON data from Cesium Ion
            const resource = await Cesium.IonResource.fromAssetId(2748775);
            geoJsonDataSource = await Cesium.GeoJsonDataSource.load(resource, {
                clampToGround: true,
                fill: new Cesium.Color(1, 165/255, 0, 0.7),
            });
            // Check if the GeoJSON data source is successfully loaded
            if (geoJsonDataSource) {
                // Synchronize and set up GeoJSON visibility checkboxes
                synchronizeCheckboxes();
                // Add the loaded GeoJSON data source to the Cesium viewer
                viewer.dataSources.add(geoJsonDataSource);
                // Populate the glacier dropdown with names from GeoJSON entities
                populateGlacierDropdown();
            }
        }

        function createTransparencySlider(panelId, dataSource) {
            var panel = document.getElementById(panelId);
            var slider = document.createElement('input');
            slider.type = 'range';
            slider.min = 0;
            slider.max = 1;
            slider.step = 0.01;
            slider.value = 0.5;
            slider.className = 'geojson-transparency-slider';
            slider.oninput = function() {
            var newAlpha = parseFloat(this.value);
            dataSource.entities.values.forEach(function(entity) {
                // Update the alpha component of the polygon material color
                if (entity.polygon && entity.polygon.material && entity.polygon.material.color) {
                    var color = entity.polygon.material.color.getValue();
                    entity.polygon.material = new Cesium.Color(color.red, color.green, color.blue, newAlpha);
                }
            });
        };

        // Append the slider to the panel
        panel.appendChild(slider);
        }

        let initialGeoJSONCheckbox1;
        let initialGeoJSONCheckbox2;
        /****************************************************************************
        * Synchronizes checkboxes for controlling the visibility of the GeoJSON layer.
        ****************************************************************************/
        function synchronizeCheckboxes() {
            // Find the GeoJSON checkboxes in both panels
            initialGeoJSONCheckbox1 = document.querySelector('#layerControls #InitialGeoJSON');
            initialGeoJSONCheckbox2 = document.querySelector('#layerControls2 #InitialGeoJSON');
            // Set both checkboxes as checked by default and ensure the GeoJSON layer is shown
            initialGeoJSONCheckbox1.checked = initialGeoJSONCheckbox2.checked = geoJsonDataSource.show = true;
            // Add change event listeners to both checkboxes for synchronization
            initialGeoJSONCheckbox1.addEventListener('change', function() {
                geoJsonDataSource.show = this.checked;
                initialGeoJSONCheckbox2.checked = this.checked;
            });
            initialGeoJSONCheckbox2.addEventListener('change', function() {
                geoJsonDataSource.show = this.checked;
                initialGeoJSONCheckbox1.checked = this.checked;
            });
        }

        /**********************************************************************
        * Populates the dropdown menu with glacier names from the GeoJSON data.
        *********************************************************************/
        // Populating the dropdown with only "Tayrona" and "El Tuparro"
        function populateGlacierDropdown() {
            // Add a placeholder option to the dropdown
            let placeholderOption = document.createElement('option');
            placeholderOption.textContent = 'Select Park';
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            dropdownGlacier.appendChild(placeholderOption);

            // Define the parks you want in the dropdown
            const allowedParks = ['Tayrona', 'El Tuparro'];

            // Extract only the allowed parks from the GeoJSON entities
            let parkNames = geoJsonDataSource.entities.values
                .filter(entity => allowedParks.includes(entity.properties.nombre.getValue())) // Filter for Tayrona and El Tuparro
                .map(entity => entity.properties.nombre.getValue())  // Extract the 'nombre' field
                .sort();  // Sort alphabetically (optional)

            // Add a sorted option for each park entity in the GeoJSON data
            parkNames.forEach((name) => {
                let option = document.createElement('option');
                option.textContent = name;
                option.value = name;
                dropdownGlacier.appendChild(option);
            });
        }

        function preloadImages(imageUrls) {
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
            });
        }

        // Call this function with an array of all image URLs used in the description panels
        preloadImages([
            //El Tuparro
            'https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_AIR.png',
            'https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_Forest.png',
            'https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_LST.png',
            //Tayrona
            'https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_AIR.png',
            'https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_Forest.png',
            'https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_LST.png',
          
            // ... add all other image URLs here ...


        ]);

        // Call the function to load GeoJSON data
        loadGeoJson();

        let selectedName;  // Name of the selected glacier
        let glaciersWithImagery = new Set();  // Set to store names of glaciers with imagery
        /********************************************************************************
        * Dropdown Glacier Selection Event Listener
        * - Listens for changes in the glacier selection dropdown.
        * - Updates the selected glacier and manages entity appearance and descriptions.
        ********************************************************************************/

        
        dropdownGlacier.addEventListener('change', function() {
        selectedName = this.value;

        // Find the selected entity by 'nombre' (since 'name' is no longer valid)
        const selectedEntity = geoJsonDataSource.entities.values.find(entity => {
            return entity.properties.nombre.getValue() === selectedName;
        });

        if (lastSelectedEntity) {
            // Reset the appearance of the previously selected entity
            lastSelectedEntity.polygon.material = new Cesium.Color(30/255, 33/255, 70/255, 0.5);
        }

        if (selectedEntity) {
            updateEntityAppearance(selectedEntity);
            flyToAndDescribeEntity(selectedEntity);
            lastSelectedEntity = selectedEntity;
        }
        });

        /********************************************************************************
        * Function to Update Entity Appearance
        * - Updates the color of the entity based on the presence of imagery.
        ********************************************************************************/
        function updateEntityAppearance(entity) {
            if (glaciersWithImagery.has(entity.name)) {
                entity.polygon.material = new Cesium.Color(30/255, 33/255, 70/255, 0);
            } else {
                entity.polygon.material = Cesium.Color.YELLOW.withAlpha(0.5);
            }
        }

        /********************************************************************************
        * Function to Fly to an Entity and Describe It
        * - Focuses the viewer on the selected entity and sets its description.
        ********************************************************************************/
        function flyToAndDescribeEntity(entity) {
            viewer.flyTo(entity).then(function () {
                setDescription(entity);
            });
        }

        /********************************************************************************
        * Function to Set the Description of an Entity
        * - Assigns a unique HTML description to an entity based on its name.
        ********************************************************************************/
        function setDescription(entity) {
            let descriptionHtml = "";
            switch (entity.properties.nombre.getValue()) {
                case 'Tayrona':
                    descriptionHtml = 
                    `
                        <h2>Time Series Charts </h2>
                        <h3>Forest Area</h3>
                        <a href="https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_Forest.png" target="_blank">
                            <img src='https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_Forest.png' alt='AGASSIZ-BOLADOS' style='width: 100%; height: auto; max-height: 100%; display: block;'>
                        </a>    
                        <h3>Land Surface Temperature (LST) </h3>
                        <a href="https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_LST.png" target="_blank">
                            <img src='https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_LST.png' alt='AGASSIZ-BOLADOS' style='width: 100%; height: auto; max-height: 100%; display: block;'>
                        </a>   
                        <h3>Air Temperature</h3>
                        <a href="https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_AIR.png" target="_blank">
                            <img src='https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tayrona_AIR.png' alt='AGASSIZ-BOLADOS' style='width: 100%; height: auto; max-height: 100%; display: block;'>
                        </a>
                    `;
                break;   
                
                case 'El Tuparro':
                    descriptionHtml = 
                    `
                        <h2>Time Series Charts </h2>
                        <h3>Forest Area</h3>
                        <a href="https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_Forest.png" target="_blank">
                            <img src='https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_Forest.png' alt='AGASSIZ-BOLADOS' style='width: 100%; height: auto; max-height: 100%; display: block;'>
                        </a>    
                        <h3>Land Surface Temperature (LST) </h3>
                        <a href="https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_LST.png" target="_blank">
                            <img src='https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_LST.png' alt='AGASSIZ-BOLADOS' style='width: 100%; height: auto; max-height: 100%; display: block;'>
                        </a>   
                        <h3>Air Temperature</h3>
                        <a href="https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_AIR.png" target="_blank">
                            <img src='https://raw.githubusercontent.com/felipecamachoh/Forest_Application/refs/heads/main/Images/Tuparro_AIR.png' alt='AGASSIZ-BOLADOS' style='width: 100%; height: auto; max-height: 100%; display: block;'>
                        </a>
                    `;
                break;  
                // Add cases for other glaciers with their unique descriptions
                default:
                    // Default action or description for entities not specifically handled
                    descriptionHtml = "<p>Temporarily Unavailable.</p>";
                break;
            }
            // Set the entity description
            entity.description = descriptionHtml;
            viewer.selectedEntity = entity;
            // Adjust the size of the InfoBox after the content is set
            adjustInfoBoxSize();
        }

        /********************************************************************************
        * Function to adjust the size of the InfoBox
        ********************************************************************************/
        function adjustInfoBoxSize() {
            const infoBox = viewer.infoBox.frame;
            if (infoBox) {
                infoBox.addEventListener('load', function () {
                    try {
                        const body = infoBox.contentDocument.body;
                        infoBox.style.height = body.scrollHeight + 'px';
                    } catch(e) {
                        console.error("Could not adjust iframe height:", e);
                    }
                });
            }
        }
        const infoBox = viewer.infoBox.frame;
        if (infoBox && infoBox.contentDocument && infoBox.contentDocument.body) {
            infoBox.style.maxHeight = '600px';
        }

        /********************************************************************************
        * Screen Space Event Handler for Clicks on Entities
        * - Detects clicks on entities within the viewer.
        * - Sets the description of the clicked entity if it matches the selected glacier.
        ********************************************************************************/
        const clickHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
        clickHandler.setInputAction(function(click) {
            const pickedObject = viewer.scene.pick(click.position);
            if (Cesium.defined(pickedObject) && Cesium.defined(pickedObject.id)) {
                const pickedEntity = pickedObject.id;
                if (pickedEntity.name === selectedName) {
                    setDescription(pickedEntity);
                }
            }
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
    
        let selectedYear;
        /********************************************************************************
        * Dropdown Year Selection Event Listener
        * - Listens for changes in the year dropdown selection.
        * - Updates the global `selectedYear` variable based on the user's choice.
        ********************************************************************************/
        dropdownYear.addEventListener('change', function() {
            // Update `selectedYear` with the selected option's text
            selectedYear = this.options[this.selectedIndex].text;
        });

        /********************************************************************************
        * Viewer Screen Space Event Handler for Left Clicks
        * - Sets an event listener for left mouse button clicks within the Cesium viewer.
        * - Picks and logs the name of the clicked feature (if any) in the console.
        * - This can be useful for debugging or for future feature implementation.
        ********************************************************************************/
        viewer.screenSpaceEventHandler.setInputAction(function onLeftClick(movement) {
            // Pick the feature at the clicked position
            var pickedFeature = viewer.scene.pick(movement.position);    
            // Check if a feature was picked and log its name
            if (Cesium.defined(pickedFeature)) {
                console.log(pickedFeature.id.name);
            }
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

        let addedImageryLayers = {};

        /********************************************************************************
        * UI Elements
        ********************************************************************************/
        var layerControls1 = document.getElementById('layerControls');
        var layerControls3 = document.getElementById('layerscontrol2-dropdown');
        /********************************************************************************
        * Toggle Imagery Event Handler
        * - Handles the click event for the toggle imagery button.
        * - Manages the addition of imagery layers based on selected glacier and year.
        * - Updates UI elements accordingly.
        ********************************************************************************/        
        document.querySelector('#toggle-imagery').onclick = async function() {
            const selectedImageryType = document.getElementById('dropdow-imagery').options[document.getElementById('dropdow-imagery').selectedIndex].text;
            let layerKey = `${selectedName}-${selectedImageryType}-${selectedYear}`;
            let assetId = getAssetId(selectedName, selectedYear, selectedImageryType);
            // Reset the opacity and display properties to ensure the container is visible
            const statusContainer = document.getElementById('layer-status-container');
            statusContainer.style.opacity = '1';
            statusContainer.style.display = 'grid';
            if (assetId) {
                resetLastSelectedEntityAppearance();
                if (!addedImageryLayers[layerKey]) {
                    try {
                        const imageryProvider = await Cesium.IonImageryProvider.fromAssetId(assetId);
                        let imageryLayer = viewer.imageryLayers.addImageryProvider(imageryProvider);
                        if (selectedImageryType === "Forest Area") {
                            imageryLayer.alpha = 0.8; // Default transparency for Glacier Area
                        } else if (selectedImageryType === "Air Temperature" || selectedImageryType === "Land Surface Temperature") {
                            imageryLayer.alpha = 0.8; // Increased transparency for temperature data
                        }
                        addedImageryLayers[layerKey] = imageryLayer;
                        appendCheckboxToPanels(layerKey);
                        glaciersWithImagery.add(selectedName);
                        updateUIOnImageryAddition(selectedImageryType);
                        // Update split direction based on swipe enabled state
                        if (isSwipeEnabled) {
                            let checkboxInFirstPanel = document.querySelector(`#layerControls #${layerKey.replace(/[^a-zA-Z0-9]/g, '_')}Checkbox`);
                            imageryLayer.splitDirection = checkboxInFirstPanel && checkboxInFirstPanel.checked ? Cesium.SplitDirection.LEFT : Cesium.SplitDirection.RIGHT;
                        } else {
                            // If swipe is not enabled, the imagery should cover the entire viewer
                            imageryLayer.splitDirection = Cesium.SplitDirection.NONE;
                        }
                        document.getElementById('legend-controls').style.display='block'
                        document.getElementById('legend-controls').textContent = 'Hide Legend';
                        document.getElementById('legends-container').style.backgroundColor = "rgba(161, 158, 158, 0.44)";
                        // Set the message and background color based on the scenario
                        document.getElementById('layer-status-message').textContent = "The following imagery was added successfully: " + layerKey;
                        statusContainer.style.backgroundColor = "rgba(69, 160, 73,0.8)";
                        // Call the fade-out function after setting up everything
                        fadeOutStatusContainer();
                    } catch (error) {
                        console.error("Error adding imagery layer:", error);
                    }
                } else {
                    document.getElementById('layer-status-message').textContent = "The following imagery is already added: " + layerKey;
                    document.getElementById('layer-status-message').style.color = "black"
                    document.getElementById('close-layer-status').style.color = "black"
                    statusContainer.style.backgroundColor = "rgba(244, 172, 50,0.8)";
                    fadeOutStatusContainer();
                }
            } else {
                document.getElementById('layer-status-message').textContent = "The following imagery is not available: " + layerKey;
                statusContainer.style.backgroundColor = "rgba(102, 16, 31,0.8)";
                fadeOutStatusContainer();
            }
        };

        function fadeOutStatusContainer() {
            // Clear any existing timeout to ensure smooth behavior on rapid clicks
            clearTimeout(window.fadeOutTimeout);
            window.fadeOutTimeout = setTimeout(() => {
                document.getElementById('layer-status-container').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('layer-status-container').style.display = 'none';
                }, 2000); // Duration of the opacity transition
            }, 5000); // Delay before starting the fade out
        }

        /********************************************************************************
        * Helper Functions
        ********************************************************************************/
        function getAssetId(name, year, imageryType) {
            // Define a mapping for each combination of glacier, year, and imagery type name
            const assetMapping = {
                //El Tuparro
                'El Tuparro-2018 - 2019-Forest Area': 2748807,    
                'El Tuparro-2019 - 2020-Forest Area': 2748816,
                'El Tuparro-2020 - 2021-Forest Area': 2748834,

                'El Tuparro-2018 - 2019-Land Surface Temperature': 2748860,    
                'El Tuparro-2019 - 2020-Land Surface Temperature': 2748861,
                'El Tuparro-2020 - 2021-Land Surface Temperature': 2748862,
                

                'El Tuparro-2018 - 2019-Air Temperature': 2748875,    
                'El Tuparro-2019 - 2020-Air Temperature': 2748876,
                'El Tuparro-2020 - 2021-Air Temperature': 2748878,

                //Tayrona
                'Tayrona-2018 - 2019-Forest Area': 2748837,    
                'Tayrona-2019 - 2020-Forest Area': 2748840,
                'Tayrona-2020 - 2021-Forest Area': 2748841,

                'Tayrona-2018 - 2019-Land Surface Temperature': 2748859,    
                'Tayrona-2019 - 2020-Land Surface Temperature': 2748858,
                'Tayrona-2020 - 2021-Land Surface Temperature': 2473696,
                

                'Tayrona-2018 - 2019-Air Temperature': 2748881,    
                'Tayrona-2019 - 2020-Air Temperature': 2748880,
                'Tayrona-2020 - 2021-Air Temperature': 2748879,
              

                
                // Add more mappings for other combinations here
            };
            return assetMapping[`${name}-${year}-${imageryType}`];
        }

        function resetLastSelectedEntityAppearance() {
            if (lastSelectedEntity) {
                lastSelectedEntity.polygon.material = Cesium.Color.BLACK.withAlpha(0.0);
            }
        }

        function appendCheckboxToPanels(layerKey) {
            appendCheckboxToPanel(layerKey, layerControls1, Cesium.SplitDirection.LEFT);
            appendCheckboxToPanel(layerKey, layerControls3, Cesium.SplitDirection.RIGHT);
        }

        // Global flags to track if the legends have already been shown
        let glacierAreaLegendShown = false;
        let lstLegendShown = false;
        let airLegendShown = false;
        function updateUIOnImageryAddition(selectedImageryType) {
            // Update visibility based on the type of imagery selected
            if (selectedImageryType === "Forest Area" && !glacierAreaLegendShown) {
                glacierAreaLegendShown = true;
            } else if (selectedImageryType === "Land Surface Temperature" && !lstLegendShown) {
                lstLegendShown = true;
            } else if (selectedImageryType === "Air Temperature" && !airLegendShown) {
                airLegendShown = true;
            }
            // Update the display of all legends based on their shown flags
            document.getElementById('legend').style.display = glacierAreaLegendShown ? 'block' : 'none';
            document.getElementById('legend-LST').style.display = lstLegendShown ? 'block' : 'none';
            document.getElementById('legend-AIR').style.display = airLegendShown ? 'block' : 'none';
        }
                
        // Sets to keep track of which layers are controlled by each panel
        let layersControlledByPanel1 = new Set();
        let layersControlledByPanel2 = new Set();

        /********************************************************************************
        * Function to Append a Checkbox to a Specified Panel
        * - This function creates and appends a checkbox and a transparency slider for a given imagery layer to a specified UI panel.
        * - It also sets up event handlers to manage the visibility and transparency of the imagery layer based on user interaction.
        * @param {string} layerKey - The key identifying the layer.
        * @param {HTMLElement} panel - The panel where the checkbox and slider will be appended.
        * @param {Cesium.SplitDirection} splitDirection - Split direction used for setting up the imagery layer (not used in this function, but can be extended for future use).
        ********************************************************************************/
        function appendCheckboxToPanel(layerKey, panel, splitDirection) {
            // Create a safe key for the layer to use in DOM elements (removing special characters and spaces)
            var safeLayerKey = layerKey.replace(/[^a-zA-Z0-9]/g, '_');
            // Create a label element to group the checkbox and slider
            var label = document.createElement('label');
            label.id = safeLayerKey + 'Label';
            // Create and configure the layer toggle checkbox
            var layerToggleCheckbox = document.createElement('input');
            layerToggleCheckbox.type = 'checkbox';
            layerToggleCheckbox.checked = true;
            layerToggleCheckbox.id = safeLayerKey + 'Checkbox';
            // Create and configure the transparency slider for the layer
            var transparencySlider = document.createElement('input');
            transparencySlider.type = 'range';
            transparencySlider.min = 0;
            transparencySlider.max = 1;
            transparencySlider.step = 0.1;
            transparencySlider.value = addedImageryLayers[layerKey] ? addedImageryLayers[layerKey].alpha : 0.5;
            transparencySlider.id = safeLayerKey + 'Slider';
            // Event handler for checkbox change
            layerToggleCheckbox.onchange = function() {
                if (addedImageryLayers[layerKey]) {
                    addedImageryLayers[layerKey].show = this.checked;
                    updateLayerVisibility();
                }
            };
            // Event handler for slider input
            transparencySlider.oninput = function() {
                if (addedImageryLayers[layerKey]) {
                    addedImageryLayers[layerKey].alpha = parseFloat(this.value);
                        syncSliderState(layerKey, this.value, panel);
                }
            };
            // Append the created elements to the label and then to the panel
            label.appendChild(layerToggleCheckbox);
            label.appendChild(document.createTextNode(layerKey));
            label.appendChild(transparencySlider);
            // Insert the new label at the beginning of the panel
            if (panel.firstChild) {
                panel.insertBefore(label, panel.firstChild);
            } else {
                panel.appendChild(label);
            }
            // Uncheck the checkbox in the second panel by default if swipe is enabled
            if (isSwipeEnabled && panel.id === 'layerscontrol2-dropdown') {
                layerToggleCheckbox.checked = false;
            }
        }    

        /********************************************************************************
        * Function to Synchronize Slider State Between Panels
        * - This function ensures that the transparency sliders for a specific layer
        *   in different control panels are synchronized.
        * - When the slider value is changed in one panel, it updates the corresponding
        *   slider in the other panel to reflect the same value.
        * - This keeps the UI consistent and intuitive for the user.
        * @param {string} layerKey - The key identifying the layer for which the sliders are synchronized.
        * @param {number} value - The new value of the slider (transparency level).
        * @param {HTMLElement} currentPanel - The panel where the slider value was changed.
        ********************************************************************************/
        function syncSliderState(layerKey, value, currentPanel) {
            // Create a safe version of the layer key for use in DOM element IDs
            var safeLayerKey = layerKey.replace(/[^a-zA-Z0-9]/g, '_');    
            // Query for the corresponding sliders in both control panels
            var slider1 = document.querySelector(`#layerControls #${safeLayerKey}Slider`);
            var slider2 = document.querySelector(`#layerscontrol2-dropdown #${safeLayerKey}Slider`);
            // Synchronize the slider value in the other panel
            if (currentPanel === layerControls1 && slider2) {
                slider2.value = value;
            } else if (currentPanel === layerControls3 && slider1) {
                slider1.value = value;
            }
        }


        /********************************************************************************
        * Event Listener for Toggling the Visibility of the Initial GeoJSON Layer
        * - This event listener is attached to a checkbox (or similar control) identified by the ID 'InitialGeoJSON'.
        * - It manages the visibility of the GeoJSON layer in the Cesium viewer.
        * - When the state of the checkbox changes (checked/unchecked), this event listener updates the 
        *   visibility of the GeoJSON layer accordingly.
        * - It ensures that the display of the GeoJSON layer on the map can be controlled interactively by the user.
        ********************************************************************************/
        document.querySelector('#InitialGeoJSON').addEventListener('change', function() {
            // Check if the GeoJSON data source is available
            if (geoJsonDataSource) {
                // Toggle the visibility of the GeoJSON layer based on the checkbox's state
                geoJsonDataSource.show = this.checked;
            }
        });


        /********************************************************************************
        * Swipe Functionality Variables
        ********************************************************************************/
        let isSwipeEnabled = false; 
        let swipeElement;
        /********************************************************************************
        * Function to Initialize Swipe Functionality
        * - Creates a swipe element that allows users to interactively control the split view in the Cesium viewer.
        * - Ensures that the swipe element is only created once and avoids re-creation if it already exists.
        ********************************************************************************/
        function initializeSwipe() {
            // Check if swipeElement already exists to prevent re-initialization
            if (swipeElement) {
                return; // Exit the function if swipe is already initialized
            }
            // Create a new div element for the swipe functionality
            swipeElement = document.createElement('div');
            swipeElement.style.position = 'absolute';
            swipeElement.style.left = (lastSwipePosition * 100) + '%';
            viewer.scene.splitPosition = lastSwipePosition;
            swipeElement.style.top = '0';
            swipeElement.style.bottom = '0';
            swipeElement.style.width = '5px';
            swipeElement.style.backgroundColor = '#d3d3d3';
            swipeElement.style.cursor = 'ew-resize';
            swipeElement.style.zIndex = '999';
            // Create handle element
            var handle = document.createElement('div');
            handle.style.position = 'absolute';
            handle.style.top = '50%';
            handle.style.left = '-10px';
            handle.style.width = '20px';
            handle.style.height = '20px';
            handle.style.backgroundColor = '#d3d3d3';
            handle.style.border = '2px solid black'; 
            handle.style.borderRadius = '0px';
            handle.style.cursor = 'ew-resize';
            handle.style.transform = 'translateY(-50%)';
            swipeElement.appendChild(handle);
            document.body.appendChild(swipeElement); 
            // Initialize variable to track the dragging state
            let isDragging = false;
            // Event listener for starting the drag
            swipeElement.addEventListener('mousedown', function(e) {
                isDragging = true;
                e.preventDefault();
            });
            // Event listener for dragging the swipe element
            window.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    // Calculate the new position based on the cursor's position
                    let viewerRect = viewer.container.getBoundingClientRect();
                    let position = (e.clientX - viewerRect.left) / viewerRect.width;
                    swipeElement.style.left = (position * 100) + '%';
                    viewer.scene.splitPosition = position;
                    lastSwipePosition = position;
                }
            });
            // Event listener for releasing the drag
            window.addEventListener('mouseup', function() {
                isDragging = false; // Disable dragging
            });
        }

        /********************************************************************************
        * Function to Update Layer Visibility
        * - Adjusts the visibility and split direction of layers based on the state of the checkboxes in both control panels.
        * - Handles both the GeoJSON layer and other imagery layers.
        ********************************************************************************/
        function updateLayerVisibility() {
            // Update GeoJSON Layer Visibility
            if (geoJsonDataSource) {
                const geoJsonCheckbox1 = document.querySelector('#layerControls #InitialGeoJSON');
                const geoJsonCheckbox2 = document.querySelector('#layerscontrol2-dropdown #InitialGeoJSON');
                // Check if swipe is enabled and set visibility accordingly
                if (isSwipeEnabled) {
                    // If swipe is enabled, the GeoJSON layer is visible if either of the checkboxes is checked
                    geoJsonDataSource.show = geoJsonCheckbox1.checked || geoJsonCheckbox2.checked;
                } else {
                    // If swipe is not enabled, the GeoJSON layer visibility depends only on the first checkbox
                    geoJsonDataSource.show = geoJsonCheckbox1.checked;
                }
            }
            // Update Imagery Layers Visibility
            Object.keys(addedImageryLayers).forEach(layerKey => {
                const layer = addedImageryLayers[layerKey];
                const checkbox1 = document.querySelector(`#layerControls #${layerKey.replace(/[^a-zA-Z0-9]/g, '_')}Checkbox`);
                const checkbox2 = document.querySelector(`#layerscontrol2-dropdown #${layerKey.replace(/[^a-zA-Z0-9]/g, '_')}Checkbox`);
                if (layer) {
                // Check if swipe is enabled and set visibility and split direction accordingly
                if (isSwipeEnabled) {
                    // If swipe is enabled, the layer is visible if either of the checkboxes is checked
                    layer.show = checkbox1.checked || checkbox2.checked;
                    // Set the split direction based on which checkbox is checked
                    if (checkbox1.checked && checkbox2.checked) {
                        // No split direction when both checkboxes are checked
                        layer.splitDirection = Cesium.SplitDirection.NONE;
                    } else if (checkbox1.checked) {
                        layer.splitDirection = Cesium.SplitDirection.LEFT;
                    } else if (checkbox2.checked) {
                        layer.splitDirection = Cesium.SplitDirection.RIGHT;
                    } else {
                        // Default to no split direction if neither is checked (though layer.show would be false in this case)
                        layer.splitDirection = Cesium.SplitDirection.NONE;
                    }
                } else {
                    // If swipe is not enabled, the layer visibility depends only on the first checkbox
                    layer.show = checkbox1.checked;
                    layer.splitDirection = Cesium.SplitDirection.NONE; // No split direction when swipe is disabled
                }
            }
            });
        }

        let lastSwipePosition = 0.5; // Default to the middle, update as needed
        /********************************************************************************
        * Event Listener for Toggle-Swipe Button
        * - Toggles the swipe functionality on and off.
        * - Changes the appearance of the button based on the state of the swipe.
        * - Manages the display of the second layer control panel and resets layers when swipe is disabled.
        ********************************************************************************/

        // Global variable to store the state of checkboxes in the second panel
        let layerVisibilityState = {};
        // Function to store the state of all checkboxes in a given panel
        function storeCheckboxStates(panelId) {
            const checkboxes = document.querySelectorAll(`#${panelId} input[type="checkbox"]`);
            checkboxes.forEach(checkbox => {
                layerVisibilityState[checkbox.id] = checkbox.checked;
            });
        }

        // Function to restore the state of all checkboxes in a given panel
        function restoreCheckboxStates(panelId) {
            const checkboxes = document.querySelectorAll(`#${panelId} input[type="checkbox"]`);
            checkboxes.forEach(checkbox => {
                checkbox.checked = layerVisibilityState[checkbox.id] || false; // Restore state or default to false
                initialGeoJSONCheckbox2.checked = initialGeoJSONCheckbox1.checked
            });
        }

        document.getElementById('toggle-swipe').addEventListener('click', function() {
        // Toggle the swipe state
        isSwipeEnabled = !isSwipeEnabled;
        // Change the button color based on the swipe state
        if (isSwipeEnabled) {
            this.style.backgroundColor = 'green';
            // Restore the checkbox states for the second panel when enabling swipe
            restoreCheckboxStates('layerscontrol2-dropdown');
            // Initialize swipe or show the second panel
            initializeSwipe();
            document.getElementById('layerControls2').style.display = 'block';
            document.getElementById('layers-container').style.gridTemplateColumns = 'repeat(2, minmax(0, 1fr))';
            document.getElementById('layers-container').style.right = '250px';
            document.querySelector('#layerControls2 .dropbtn').textContent = "Right Side";
            document.querySelectorAll('.dropbtn')[0].textContent = "Left Side";
            } 
            else {
                this.style.backgroundColor = '';
                document.getElementById('layers-container').style.gridTemplateColumns = 'repeat(1, minmax(0, 1fr))'
                document.querySelectorAll('.dropbtn')[0].textContent = "Layers";
                // Store the checkbox states for the second panel before disabling swipe
                storeCheckboxStates('layerscontrol2-dropdown');
                document.getElementById('layers-container').style.right = '300px';  
            }
            // Reference to the second layer control panel
            var layerControls2Panel = document.getElementById('layerControls2');
            // Initialize swipe or reset layers based on the swipe state
            if (isSwipeEnabled) {
                initializeSwipe();
                layerControls2Panel.style.display = 'block';
            } 
            else {
                if (swipeElement && swipeElement.parentNode) {
                    lastSwipePosition = viewer.scene.splitPosition; // Store the last swipe position
                    swipeElement.parentNode.removeChild(swipeElement); // Remove the swipe element
                    swipeElement = null;
                }
                layerControls2Panel.style.display = 'none';
                resetLayersToNormal();
            }

            // Update the visibility of all layers
            updateLayerVisibility();
        });
        
        /********************************************************************************
        * Function to Uncheck and Hide Right Panel Layers
        * - Unchecks all checkboxes in the second layer control panel, except for a specific checkbox (e.g., 'InitialGeoJSON').
        ********************************************************************************/
        function uncheckAndHideRightPanelLayers() {
            const checkboxes = document.querySelectorAll('#layerscontrol2-dropdown input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.id !== "InitialGeoJSON") {
                    checkbox.checked = false;
                }
            });
        }

        /********************************************************************************
        * Function to Reset Layers to Normal State
        * - Resets the GeoJSON layer and imagery layers to their normal visibility and split direction.
        * - This is used when the swipe functionality is turned off.
        ********************************************************************************/
        function resetLayersToNormal() {
            // Reset the GeoJSON layer visibility
            if (geoJsonDataSource) {
                geoJsonDataSource.show = document.querySelector('#layerControls #InitialGeoJSON').checked;
            }
            // Reset the visibility and split direction of imagery layers
            Object.keys(addedImageryLayers).forEach(layerKey => {
                const layer = addedImageryLayers[layerKey];
                if (layer) {
                    layer.splitDirection = Cesium.SplitDirection.NONE;
                    layer.show = document.querySelector(`#layerControls #${layerKey.replace(/[^a-zA-Z0-9]/g, '_')}Checkbox`).checked;
                }
            });

            // Update the visibility of all layers
            updateLayerVisibility();
        }
            
        /**********************************************************************
        * Function to Close the Splash Screen and Fly to the GeoJSON Data Source
        * - Hides the splash screen when called.
        * - If it's the initial time closing the splash screen, it triggers a 'fly-to' animation to the GeoJSON data source in the viewer.
        * - Ensures that the 'fly-to' animation only occurs the first time the splash screen is closed.
        *********************************************************************/
        function closeSplashAndFlyTo() {
            // Hide the splash screen
            document.getElementById('splashScreen').style.display = 'none';
            document.getElementById('splashScreen2').style.display = 'none';
            document.getElementById('splashScreen3').style.display = 'none';
            document.getElementById('splashScreen4').style.display = 'none';
            // Fly to the GeoJSON data source only on the initial closing of the splash screen
            if (!initialSplashScreenClosed) {
                viewer.flyTo(geoJsonDataSource);
                initialSplashScreenClosed = true; // Mark that the initial splash screen has been closed
            }
        }

        // Attach the closeSplashAndFlyTo function to the close button on the splash screen
        document.getElementById('splashScreen').querySelector('button').onclick = closeSplashAndFlyTo;
        document.getElementById('getstarted2').onclick = closeSplashAndFlyTo;
        document.getElementById('getstarted3').onclick = closeSplashAndFlyTo;
        document.getElementById('getstarted4').onclick = closeSplashAndFlyTo;

        /***************************************************************************************
        * Event Listener for the Navigation Help Button
        * - Toggles the display of the splash screen when the navigation help button is clicked.
        * - This provides an easy way for users to access the splash screen and navigation instructions at any time.
        ************************************************************************************************/
        document.querySelector('.cesium-navigation-help-button').addEventListener('click', function() {
            let splashScreen = document.getElementById('splashScreen');
            if (splashScreen) {
                // Check if the splash screen is currently hidden
                if (splashScreen.style.display === 'none') {
                    // If hidden, show the splash screen
                    splashScreen.style.display = 'block';
                } else {
                    // If shown, hide the splash screen
                    splashScreen.style.display = 'none';
                }
            }
        });

        viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(e) {
        // Prevent the default home command
        e.cancel = true;
        // Fly to the geoJsonDataSource instead
        viewer.flyTo(geoJsonDataSource, {
                duration: 5.0  // Duration in seconds
            });
        });

        //Zoom listener
        viewer.camera.moveEnd.addEventListener(function() { 
        // the camera stopped moving
        updateDistanceScale();
        });

        /***************************************************************************************
        * Function for the creation of the Distance Scale
        ************************************************************************************************/
        function updateDistanceScale() {
            var geodesic = new Cesium.EllipsoidGeodesic();
            var distances = [
                1, 2, 3, 5,
                10, 20, 30, 50,
                100, 200, 300, 500,
                1000, 2000, 3000, 5000,
                10000, 20000, 30000, 50000,
                100000, 200000, 300000, 500000,
                1000000, 2000000, 3000000, 5000000,
                10000000, 20000000, 30000000, 50000000
            ];
            var width = viewer.scene.canvas.clientWidth;
            var height = viewer.scene.canvas.clientHeight;

            var left = viewer.scene.camera.getPickRay(new Cesium.Cartesian2((width / 2) | 0, height - 1));
            var right = viewer.scene.camera.getPickRay(new Cesium.Cartesian2(1 + (width / 2) | 0, height - 1));
            var globe = viewer.scene.globe;

            var leftPosition = globe.pick(left, viewer.scene);
            var rightPosition = globe.pick(right, viewer.scene);

            if (typeof leftPosition == "undefined" || typeof rightPosition == "undefined") {
                $("#scalebartag").text("Distance Scale");
                return;
            }
            var leftCartographic = globe.ellipsoid.cartesianToCartographic(leftPosition);
            var rightCartographic = globe.ellipsoid.cartesianToCartographic(rightPosition);

            geodesic.setEndPoints(leftCartographic, rightCartographic);

            var pixelDistance = geodesic.surfaceDistance; // This is now in meters
            var maxBarWidth = 100;
            var distance;
            var label;
            var units;

            for (var i = distances.length - 1; i >= 0; --i) {
                if (distances[i] / pixelDistance < maxBarWidth) {
                    if (distances[i] >= 1000) { // Now checking for greater than or equal to 1000 meters
                        distance = distances[i] / 1000; // Convert to kilometers
                        units = " km";
                    } else {
                        distance = distances[i]/1000; // Use km
                        units = " km";
                    }
                    break;
                }
            }
            if (typeof distance !== "undefined") {
                label = distance.toString() + units;
                // Calculate the width of the scale bar based on the distance
                var scaleBarWidth = (distance / pixelDistance) * (width / 2);
                document.getElementById("scalebar").style.width = scaleBarWidth.toString() + "px";
                $("#scalebartag").text(label);
            } else {
                document.getElementById("scalebar").style.width = "10px";
                $("#scalebartag").text("undefined");
            }
        }

        /***************************************************************************************
        * Event Listener for the Legend buttons and functionalitites
        * - Toggles the display of the legend for the imagery.
        ************************************************************************************************/
        document.getElementById('legend-controls').addEventListener('click', function() {
            // Initialize a flag to check if any legend is shown
            let anyLegendShown = false;
            // Toggle the visibility of the Glacier Area legend if it has been shown
            if (glacierAreaLegendShown) {
                let legendGlacier = document.getElementById("legend");
                legendGlacier.style.display = legendGlacier.style.display === "none" ? "block" : "none";
                anyLegendShown = anyLegendShown || legendGlacier.style.display === "block";
            }
            // Toggle the visibility of the LST legend if it has been shown
            if (lstLegendShown) {
                let legendLST = document.getElementById("legend-LST");
                legendLST.style.display = legendLST.style.display === "none" ? "block" : "none";
                anyLegendShown = anyLegendShown || legendLST.style.display === "block";
            }
            // Toggle the visibility of the Air Temperature legend if it has been shown
            if (airLegendShown) {
                let legendAir = document.getElementById("legend-AIR");
                legendAir.style.display = legendAir.style.display === "none" ? "block" : "none";
                anyLegendShown = anyLegendShown || legendAir.style.display === "block";
            }
            // Change the button text based on its current state
            if (anyLegendShown) {
                this.textContent = "Hide Legend";
                // Set the background color when any legend is shown
                document.getElementById('legends-container').style.backgroundColor = "rgba(161, 158, 158, 0.44)";
            } else {
                this.textContent = "Show Legend";
                // Clear the background color when no legends are shown
                document.getElementById('legends-container').style.backgroundColor = "";
            }
        });

        /***************************************************************************************
        * Event Listener for closing the layers update info panel.
        ************************************************************************************************/
        document.getElementById('close-layer-status').addEventListener('click', function() {
            document.getElementById('layer-status-container').style.display = 'none';
        });

    </script>
</body>
</html>
